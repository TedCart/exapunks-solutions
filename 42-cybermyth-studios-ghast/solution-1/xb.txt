COPY M X;GET GHAST
COPY M T;GET MOSS
LINK 800
REPL CALCBOT
REPL FETCHPAY
COPY X M;SEND GHAST
VOID M
REPL FETCHPAY
COPY T M;SEND MOSS
VOID M
LINK -1
COPY 0 M
LINK 800
REPL FETCHDEBT
COPY X M;SEND GHAST
VOID M
REPL FETCHDEBT
COPY T M;SEND MOSS
VOID M
NOOP;LET CALCBOT FINISH
KILL;CALCBOT FOR 400
GRAB 400
SEEK 1
COPY F X;GET CENTS
SEEK -2;TARGET DOLLARS

TEST X < 0
TJMP NEGCENTS
SEEK 1
MODI X 100 F;FINISHCENTS
SEEK -2
JUMP DOLLARS

MARK NEGCENTS
SUBI F 1 T;DOLLARS
SEEK -1
COPY T F;NEG ADJUST $$$
MODI X 100 F;FINISHCENTS
SEEK -2

MARK DOLLARS
DIVI X 100 T
ADDI T F T;GET DOLLARS
COPY F X;GET CENTS

LINK 801
COPY T M;SEND DOLLARS
COPY X M;SEND CENTS
WIPE
HALT

MARK FETCHDEBT
COPY M X;GET GHAST/MOSS
LINK 802
GRAB 230
SEEK 1
MARK SEARCHNAME
TEST X = F
FJMP SEARCHNAME
SEEK -2
COPY F X;GET ID
DROP
;GET WHAT IS OWED
GRAB 231
MODE;SWITCH GLOBAL
MARK SEARCHID
TEST X = F
TJMP IDFOUND
SEEK 3
JUMP MIDIDLOOP
MARK IDFOUND
SEEK 1
COPY F M;SEND DOLLARS
COPY F M;SEND CENTS
MARK MIDIDLOOP
TEST EOF
FJMP SEARCHID
DROP
LINK -1
MODE;SWITCH LOCAL
COPY 0 M;CONFIRM END
HALT

MARK FETCHPAY
COPY M X;GET GHAST/MOSS
LINK 801
GRAB 220
SEEK 1
MARK SEARCHNAME2
TEST X = F
FJMP SEARCHNAME2
SEEK -2
COPY F X;GET ID
DROP
;GET WHAT IS OWED
GRAB 221
MODE;SWITCH GLOBAL
MARK SEARCHID2
TEST X = F
TJMP IDFOUND2
SEEK 3
JUMP MIDIDLOOP2
MARK IDFOUND2
SEEK 1
MULI F -1 M;SEND DOLLARS
MULI F -1 M;SEND CENTS
MARK MIDIDLOOP2
TEST EOF
FJMP SEARCHID2
DROP
LINK -1
MODE;SWITCH LOCAL
COPY 0 M;CONFIRM END
HALT

MARK CALCBOT
MODE;SWITCH GLOBAL
MAKE;400/401
COPY 0 F;WRITE DOLLARS
COPY 0 F;WRITE CENTS
MARK RECLOOP
COPY M X;GET DOLLARS
COPY M T;GET CENTS
SEEK -2
ADDI X F X
SEEK -1
COPY X F;ADD DOLLARS
ADDI T F T
SEEK -1
COPY T F;ADD CENTS
JUMP RECLOOP
